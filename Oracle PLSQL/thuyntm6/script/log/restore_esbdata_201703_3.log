Last unsuccessful login: Thu Mar 16 16:22:18 ICT 2017 on ssh from 10.98.4.166
Last login: Wed Mar 29 15:54:29 ICT 2017 on /dev/pts/78 from 10.98.4.166
This is asset of Techcombank, only permit authorized person. If you are accessing illegally, you will commit a criminal offence.
[YOU HAVE NEW MAIL]
[oracle@dr-esb-db01(/home/oracle)]$cd bin
[oracle@dr-esb-db01(/home/oracle/bin)]$ls
bk_script  esbdata2   esbinf1    esbinf2
[oracle@dr-esb-db01(/home/oracle/bin)]$cd bk_script
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$ls
bk_esbdata2.sh  bk_esbinf1.sh   bk_esbinf2.sh
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$more bk_esbdata2.sh 
#!/bin/sh
# file: /home/oracle/bin/bk_script/bk_esbdata2.sh
# -----------------------------------------------------------------
# Set enviroment agrument
# -----------------------------------------------------------------

HOSTNAME=dr-esb-db02-pub
export HOSTNAME
ORACLE_UNQNAME=esbdata2
export ORACLE_UNQNAME
ORACLE_SID="$ORACLE_UNQNAME"1
export ORACLE_SID
ORACLE_SID_DC=esbdata
export ORACLE_SID_DC
POLICY=Backup-Esbdata2
export POLICY
ORACLE_HOME=/u01/app/oracle/db11
export ORACLE_HOME
TARGET_CONNECT_STR=srv_db_backup/Window#123#Tech@$ORACLE_SID
export TARGET_CONNECT_STR
RUN_AS_USER=oracle
export RUN_AS_USER
RMAN=$ORACLE_HOME/bin/rman
export RMAN
CUSER=`id | cut -d"(" -f2 | cut -d ")" -f1`
export CUSER


RMAN_LOG_FILE=/tmp/rman_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export RMAN_LOG_FILE
BK_LOG=/tmp/bk_db_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export BK_LOG
SWITCHLOG=/home/oracle/bin/bk_script/switchlog_"$ORACLE_SID_DC".sh
export SWITCHLOG

# -----------------------------------------------------------------
# switch log DC.
# -----------------------------------------------------------------

if [ "$CUSER" = "root" ]
then
        su - $RUN_AS_USER -c "echo  " > $SWITCHLOG
        su - $RUN_AS_USER -c "echo export ORACLE_HOME=/u01/app/oracle/db11" >> $SWITCHLOG
        su - $RUN_AS_USER -c "echo $ORACLE_HOME/bin/sqlplus -s srv_db_backup/Window#123#Tech@$ORACLE_SID_DC as sysdba \<\<EOF " >> $SWITCHLOG
        su - $RUN_AS_USER -c "echo alter system archive log current\;" >> $SWITCHLOG
        su - $RUN_AS_USER -c "echo exit" >> $SWITCHLOG
        su - $RUN_AS_USER -c "echo EOF" >> $SWITCHLOG
        chmod 775 $SWITCHLOG
fi

# -----------------------------------------------------------------
# Initialize the log file.
# -----------------------------------------------------------------

> $RMAN_LOG_FILE
chmod 666 $RMAN_LOG_FILE

# -----------------------------------------------------------------
# Log the start of this script.
# -----------------------------------------------------------------

echo Script $0 >> $RMAN_LOG_FILE
echo ==== started on `date` ==== >> $RMAN_LOG_FILE
echo >> $RMAN_LOG_FILE


# -----------------------------------------------------------------
# Setup Policy
# -----------------------------------------------------------------

if [ "$NB_ORA_FULL" = "1" ]
then
    BACKUP_TYPE="INCREMENTAL LEVEL=0"
    SCHED_NAME="Full-Application-Backup"
        FILES_PER_SET=4
        TAG_TYPE=DATA_lv0
elif [ "$NB_ORA_INCR" = "1" ]
then
    BACKUP_TYPE="INCREMENTAL LEVEL=1"
    SCHED_NAME="Different-Application-Backup"
        FILES_PER_SET=10
        TAG_TYPE=DATA_lv1
elif [ "$NB_ORA_CINC" = "1" ]
then
    BACKUP_TYPE="INCREMENTAL LEVEL=1 CUMULATIVE"
elif [ "$BACKUP_TYPE" = "" ]
then
    BACKUP_TYPE="INCREMENTAL LEVEL=0"
fi

# -----------------------------------------------------------------
# rman commands for database pub.
# -----------------------------------------------------------------

CMD="
ORACLE_HOME=/u01/app/oracle/db11
export ORACLE_HOME
$RMAN target $TARGET_CONNECT_STR nocatalog msglog $RMAN_LOG_FILE append <<EOF

# -----------------------------------------------------------------
# RMAN command section
# -----------------------------------------------------------------

RUN {
CONFIGURE CONTROLFILE AUTOBACKUP ON;

ALLOCATE CHANNEL ch01   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' ;
ALLOCATE CHANNEL ch02   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' ;
ALLOCATE CHANNEL ch03   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' ;
ALLOCATE CHANNEL ch04   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' ;
ALLOCATE CHANNEL ch05   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' ;
ALLOCATE CHANNEL ch06   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' ;
ALLOCATE CHANNEL ch07   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' ;
ALLOCATE CHANNEL ch08   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' ;

SEND 'NB_ORA_SCHED=$SCHED_NAME,NB_ORA_POLICY=$POLICY,NB_ORA_SERV=dr-backup-01.headquarter.techcombank.com.vn';

CROSSCHECK ARCHIVELOG ALL;
DELETE NOPROMPT EXPIRED ARCHIVELOG ALL;
CROSSCHECK BACKUP;
DELETE EXPIRED BACKUP;
BACKUP AS COMPRESSED BACKUPSET $BACKUP_TYPE FORMAT 'data_%d_%Y%M%D_%U' DATABASE FILESPERSET $FILES_PER_SET TAG $TAG_TYPE;
host \"$SWITCHLOG\";
BACKUP AS COMPRESSED BACKUPSET NOT BACKED UP FORMAT 'arch_%d_%Y%M%D_%U' ARCHIVELOG ALL FILESPERSET 20 TAG ARCH;
BACKUP AS COMPRESSED BACKUPSET FORMAT 'ctl_%d_%Y%M%D_%U' CURRENT CONTROLFILE TAG CTRL;
DELETE NOPROMPT ARCHIVELOG UNTIL TIME 'SYSDATE-3';

RELEASE CHANNEL ch01;
RELEASE CHANNEL ch02;
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$cd ../
[oracle@dr-esb-db01(/home/oracle/bin)]$ls
bk_script  esbdata2   esbinf1    esbinf2
[oracle@dr-esb-db01(/home/oracle/bin)]$cd ../
[oracle@dr-esb-db01(/home/oracle)]$ls
DBscript             clean_audit_file.sh  esbdata2.sh          esblog21.pfile       orapwesbdata22       pfile.esbpoc.ora     rman_esbres_1.log
LMS                  crontab.job.txt      esbinf.ora           esbtest.sh           pfile.esbinf1.ora    rman_esbres.log      rman_esbres_1.rcv
OracleLMS_Aug        dbscript             esbinf1.sh           fresh_truss.ok       pfile.esblog.ora     rman_esbres.log_old  rman_esbres_1.sh
bin                  esb_restore.ora      esbinf2.sh           nohup.out            pfile.esblog1.ora    rman_esbres.rcv      time.log
clean_all_logs.sh    esbdata2.ora         esbinf21.ora         oradiag_oracle       pfile.esblog11.ora   rman_esbres.sh
[oracle@dr-esb-db01(/home/oracle)]$more esbinf1.sh
#!/bin/sh
# -----------------------------------------------------------------
# Backup script generated on 03/07/13 16:30:58
# Shell Script name: /home/oracle/bk_db_dwtest1.sh
# BK Log file name: /oracle/nbu/logs/bk_db_dwtest1_<date>.log
# Veritas NetBackup for oracle on UNIX
# $VRTScprght: Copyright 1993 - 2012 Symantec Corporation, All Rights Reserved $
# -----------------------------------------------------------------
# dw0201-vip
# dw0202-vip
# DWTEST1-VIP
# DWTEST2-VIP
# dwtest11
# dwtest12

#
#
#
RMAN_LOG_FILE=/tmp/rman8083.log
BK_LOG="/tmp/bk_db_esbinf1_full_$(date '+%Y%M%d_%H%M').log"
# exit if clien name = dw0202-vip
if [ "$NB_ORA_CLIENT" = "dr-esb-db02-pub" ]
then
        exit 0
fi
# -----------------------------------------------------------------
# Initialize the log file.
# -----------------------------------------------------------------

> $RMAN_LOG_FILE
chmod 666 $RMAN_LOG_FILE

# -----------------------------------------------------------------
# Log the start of this script.
# -----------------------------------------------------------------

echo Script $0 >> $RMAN_LOG_FILE
echo ==== started on `date` ==== >> $RMAN_LOG_FILE
echo >> $RMAN_LOG_FILE

ORACLE_HOME=/u01/app/oracle/db11
ORACLE_SID=esbinf11
TARGET_CONNECT_STR=/
