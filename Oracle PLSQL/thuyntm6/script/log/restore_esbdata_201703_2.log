Last unsuccessful login: Thu Mar 16 16:22:18 ICT 2017 on ssh from 10.98.4.166
Last login: Thu Mar 30 16:32:37 ICT 2017 on ssh from 10.98.4.166
This is asset of Techcombank, only permit authorized person. If you are accessing illegally, you will commit a criminal offence.
[YOU HAVE NEW MAIL]
[oracle@dr-esb-db01(/home/oracle)]$ps -ef|grep pmon
  oracle  5046510        1   0   Jan 09      - 18:04 ora_pmon_esbinf11
    grid  6488114        1   0   Nov 11      - 24:40 asm_pmon_+ASM1
  oracle 19857502        1   0   Nov 13      - 30:52 ora_pmon_esbinf21
  oracle 26673306 15990906   0 16:46:00 pts/79  0:00 grep pmon
  oracle 52232424        1   0   Mar 28      -  0:36 ora_pmon_esbdata21
[oracle@dr-esb-db01(/home/oracle)]$ps -ef|grep rman
  oracle 51249156 49479786   0 16:44:10 pts/78  0:01 rman target /
  oracle 51970216 51642410   0 16:40:10 pts/77  0:00 tail -100f rman_esbinf1_DAILY_20170330_1623.log
  oracle 52691040 15990906   0 16:46:05 pts/79  0:00 grep rman
  oracle 54132784 46465132   0 16:23:51      -  0:03 rman target srv_db_backup/Window#123#Tech@esbinf11 nocatalog msglog /tmp/rman_esbinf1_DAILY_20170330_1623.log append
[oracle@dr-esb-db01(/home/oracle)]$
[oracle@dr-esb-db01(/home/oracle)]$
[oracle@dr-esb-db01(/home/oracle)]$kill -9 54132784
[oracle@dr-esb-db01(/home/oracle)]$ps -ef|grep rman
  oracle 51249156 49479786   0 16:44:10 pts/78  0:01 rman target /
  oracle 51970216 51642410   0 16:40:10 pts/77  0:00 tail -100f rman_esbinf1_DAILY_20170330_1623.log
  oracle 54132822 15990906   0 16:46:31 pts/79  0:00 grep rman
[oracle@dr-esb-db01(/home/oracle)]$ls
DBscript             crontab.job.txt      esbinf1.sh           esbtest.sh           pfile.esblog.ora     rman_esbres.rcv      tests.l
LMS                  dbscript             esbinf1.sh_fix       fresh_truss.ok       pfile.esblog1.ora    rman_esbres.sh       time.log
OracleLMS_Aug        esb_restore.ora      esbinf1.sh_old       nohup.out            pfile.esblog11.ora   rman_esbres_1.log
bin                  esbdata2.ora         esbinf2.sh           oradiag_oracle       pfile.esbpoc.ora     rman_esbres_1.rcv
clean_all_logs.sh    esbdata2.sh          esbinf21.ora         orapwesbdata22       rman_esbres.log      rman_esbres_1.sh
clean_audit_file.sh  esbinf.ora           esblog21.pfile       pfile.esbinf1.ora    rman_esbres.log_old  test.sh
[oracle@dr-esb-db01(/home/oracle)]$vi esbinf1.sh
#!/bin/sh
# file: /home/oracle/bin/bk_script/bk_esbinf1.sh
# -----------------------------------------------------------------
# Set enviroment agrument
# -----------------------------------------------------------------

HOSTNAME=dr-esb-db02-pub
export HOSTNAME
ORACLE_UNQNAME=esbinf1
export ORACLE_UNQNAME
ORACLE_SID="$ORACLE_UNQNAME"1
export ORACLE_SID
ORACLE_SID_DC=esbinfra
export ORACLE_SID_DC
POLICY=Backup-Esbinf1
export POLICY
ORACLE_HOME=/u01/app/oracle/db11
export ORACLE_HOME
TARGET_CONNECT_STR=srv_db_backup/Window#123#Tech@$ORACLE_SID
export TARGET_CONNECT_STR
RUN_AS_USER=oracle
export RUN_AS_USER
RMAN=$ORACLE_HOME/bin/rman
export RMAN
CUSER=`id | cut -d"(" -f2 | cut -d ")" -f1`
export CUSER


RMAN_LOG_FILE=/tmp/rman_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export RMAN_LOG_FILE
BK_LOG=/tmp/bk_db_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export BK_LOG
SWITCHLOG=/home/oracle/bin/bk_script/switchlog_"$ORACLE_SID_DC".sh
export SWITCHLOG

# -----------------------------------------------------------------
# switch log DC.
# -----------------------------------------------------------------

if [ "$CUSER" = "root" ]
then
        echo > $SWITCHLOG
#!/bin/sh
# file: /home/oracle/bin/bk_script/bk_esbinf1.sh
# -----------------------------------------------------------------
# Set enviroment agrument
# -----------------------------------------------------------------

HOSTNAME=dr-esb-db02-pub
export HOSTNAME
ORACLE_UNQNAME=esbinf1
export ORACLE_UNQNAME
ORACLE_SID="$ORACLE_UNQNAME"1
export ORACLE_SID
ORACLE_SID_DC=esbinfra
export ORACLE_SID_DC
POLICY=Backup-Esbinf1
export POLICY
ORACLE_HOME=/u01/app/oracle/db11
export ORACLE_HOME
TARGET_CONNECT_STR=srv_db_backup/Window#123#Tech@$ORACLE_SID
export TARGET_CONNECT_STR
RUN_AS_USER=oracle
export RUN_AS_USER
RMAN=$ORACLE_HOME/bin/rman
export RMAN
CUSER=`id | cut -d"(" -f2 | cut -d ")" -f1`
export CUSER


RMAN_LOG_FILE=/tmp/rman_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export RMAN_LOG_FILE
BK_LOG=/tmp/bk_db_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export BK_LOG
SWITCHLOG=/home/oracle/bin/bk_script/switchlog_"$ORACLE_SID_DC".sh
export SWITCHLOG

# -----------------------------------------------------------------
# switch log DC.
# -----------------------------------------------------------------

if [ "$CUSER" = "root" ]
then
        echo > $SWITCHLOG
        echo "export ORACLE_HOME=/u01/app/oracle/db11" >> $SWITCHLOG

        echo "$ORACLE_HOME/bin/sqlplus -s srv_db_backup/Window#123#Tech@$ORACLE_SID_DC as sysdba <<EOF " >> $SWITCHLOG

        echo "alter system archive log current;" >> $SWITCHLOG

        echo "exit" >> $SWITCHLOG

        echo "EOF" >> $SWITCHLOG

        chmod 775 $SWITCHLOG

fi



# -----------------------------------------------------------------

# Initialize the log file.

# -----------------------------------------------------------------



> $RMAN_LOG_FILE

chmod 666 $RMAN_LOG_FILE



# -----------------------------------------------------------------

# Log the start of this script.

# -----------------------------------------------------------------



echo Script $0 >> $RMAN_LOG_FILE

echo ==== started on `date` ==== >> $RMAN_LOG_FILE

echo >> $RMAN_LOG_FILE





# -----------------------------------------------------------------

# Setup Policy

# -----------------------------------------------------------------



if [ "$NB_ORA_FULL" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=0"

    SCHED_NAME="Full-Application-Backup"

        FILES_PER_SET=4

        TAG_TYPE=DATA_lv0

elif [ "$NB_ORA_INCR" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=1"

    SCHED_NAME="Different-Application-Backup"

        FILES_PER_SET=10

        TAG_TYPE=DATA_lv1

elif [ "$NB_ORA_CINC" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=1 CUMULATIVE"

elif [ "$BACKUP_TYPE" = "" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=0"

fi



# -----------------------------------------------------------------

# rman commands for database pub.

# -----------------------------------------------------------------



CMD="

ORACLE_HOME=/u01/app/oracle/db11

export ORACLE_HOME

$RMAN target $TARGET_CONNECT_STR nocatalog msglog $RMAN_LOG_FILE append <<EOF



# -----------------------------------------------------------------

# RMAN command section

# -----------------------------------------------------------------



RUN {

CONFIGURE CONTROLFILE AUTOBACKUP ON;



ALLOCATE CHANNEL ch00   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db01-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf11';

ALLOCATE CHANNEL ch01   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db02-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf12';

ALLOCATE CHANNEL ch02   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db01-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf11';

ALLOCATE CHANNEL ch03   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db02-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf12';

ALLOCATE CHANNEL ch04   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db01-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf11';

ALLOCATE CHANNEL ch05   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db02-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf12';

ALLOCATE CHANNEL ch06   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db01-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf11';

ALLOCATE CHANNEL ch07   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db02-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf12';

SEND 'NB_ORA_SCHED=$SCHED_NAME,NB_ORA_POLICY=$POLICY,NB_ORA_SERV=dr-backup-01.headquarter.techcombank.com.vn';



CROSSCHECK ARCHIVELOG ALL;

DELETE NOPROMPT EXPIRED ARCHIVELOG ALL;

CROSSCHECK BACKUP;

DELETE EXPIRED BACKUP;

BACKUP AS COMPRESSED BACKUPSET $BACKUP_TYPE FORMAT 'data_%d_%Y%M%D_%U' DATABASE FILESPERSET $FILES_PER_SET TAG $TAG_TYPE;

host \"$SWITCHLOG\";

BACKUP AS COMPRESSED BACKUPSET NOT BACKED UP FORMAT 'arch_%d_%Y%M%D_%U' ARCHIVELOG ALL FILESPERSET 20 TAG ARCH;

BACKUP AS COMPRESSED BACKUPSET FORMAT 'ctl_%d_%Y%M%D_%U' CURRENT CONTROLFILE TAG CTRL;

DELETE NOPROMPT ARCHIVELOG UNTIL TIME 'SYSDATE-3';



RELEASE CHANNEL ch01;

RELEASE CHANNEL ch02;

RELEASE CHANNEL ch03;

RELEASE CHANNEL ch04;

RELEASE CHANNEL ch05;

RELEASE CHANNEL ch06;

RELEASE CHANNEL ch07;

RELEASE CHANNEL ch08;





"esbinf1.sh" 162 lines, 5480 characters 
[oracle@dr-esb-db01(/home/oracle)]$
[oracle@dr-esb-db01(/home/oracle)]$
[oracle@dr-esb-db01(/home/oracle)]$
[oracle@dr-esb-db01(/home/oracle)]$cd bin/bk_script
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$ls
new                     old                     switchlog_.sh           switchlog_esbinfra1.sh
new_esbinfra1.sh        switch.sh               switchlog_esbinfra.sh
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$more switchlog_esbinfra.sh

export ORACLE_HOME=/u01/app/oracle/db11
/u01/app/oracle/db11/bin/sqlplus -s srv_db_backup/Window#123#Tech@esbinfra as sysdba <<EOF 
alter system archive log current;
exit
EOF
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$cd new
[oracle@dr-esb-db01(/home/oracle/bin/bk_script/new)]$ls
esbdata2.sh            esbinf1.sh             esbinf2.sh             switchlog_esbdata.sh   switchlog_esbinfra.sh
[oracle@dr-esb-db01(/home/oracle/bin/bk_script/new)]$cp esbinf2.sh esbinf2.sh_new
[oracle@dr-esb-db01(/home/oracle/bin/bk_script/new)]$cd
[oracle@dr-esb-db01(/home/oracle)]$ls
DBscript             crontab.job.txt      esbinf1.sh           esbtest.sh           pfile.esblog.ora     rman_esbres.rcv      tests.l
LMS                  dbscript             esbinf1.sh_fix       fresh_truss.ok       pfile.esblog1.ora    rman_esbres.sh       time.log
OracleLMS_Aug        esb_restore.ora      esbinf1.sh_old       nohup.out            pfile.esblog11.ora   rman_esbres_1.log
bin                  esbdata2.ora         esbinf2.sh           oradiag_oracle       pfile.esbpoc.ora     rman_esbres_1.rcv
clean_all_logs.sh    esbdata2.sh          esbinf21.ora         orapwesbdata22       rman_esbres.log      rman_esbres_1.sh
clean_audit_file.sh  esbinf.ora           esblog21.pfile       pfile.esbinf1.ora    rman_esbres.log_old  test.sh
[oracle@dr-esb-db01(/home/oracle)]$mv esbinf2.sh esbinf2.sh_old
[oracle@dr-esb-db01(/home/oracle)]$ls
DBscript             crontab.job.txt      esbinf1.sh           esbtest.sh           pfile.esblog.ora     rman_esbres.rcv      tests.l
LMS                  dbscript             esbinf1.sh_fix       fresh_truss.ok       pfile.esblog1.ora    rman_esbres.sh       time.log
OracleLMS_Aug        esb_restore.ora      esbinf1.sh_old       nohup.out            pfile.esblog11.ora   rman_esbres_1.log
bin                  esbdata2.ora         esbinf2.sh_old       oradiag_oracle       pfile.esbpoc.ora     rman_esbres_1.rcv
clean_all_logs.sh    esbdata2.sh          esbinf21.ora         orapwesbdata22       rman_esbres.log      rman_esbres_1.sh
clean_audit_file.sh  esbinf.ora           esblog21.pfile       pfile.esbinf1.ora    rman_esbres.log_old  test.sh
[oracle@dr-esb-db01(/home/oracle)]$mv 
[oracle@dr-esb-db01(/home/oracle)]$cd bin/bk_script/new
[oracle@dr-esb-db01(/home/oracle/bin/bk_script/new)]$ls
esbdata2.sh            esbinf1.sh             esbinf2.sh             esbinf2.sh_new         switchlog_esbdata.sh   switchlog_esbinfra.sh
[oracle@dr-esb-db01(/home/oracle/bin/bk_script/new)]$mv esbinf2.sh_new ~/
[oracle@dr-esb-db01(/home/oracle/bin/bk_script/new)]$cd
[oracle@dr-esb-db01(/home/oracle)]$ls
DBscript             crontab.job.txt      esbinf1.sh           esblog21.pfile       pfile.esbinf1.ora    rman_esbres.log_old  test.sh
LMS                  dbscript             esbinf1.sh_fix       esbtest.sh           pfile.esblog.ora     rman_esbres.rcv      tests.l
OracleLMS_Aug        esb_restore.ora      esbinf1.sh_old       fresh_truss.ok       pfile.esblog1.ora    rman_esbres.sh       time.log
bin                  esbdata2.ora         esbinf2.sh_new       nohup.out            pfile.esblog11.ora   rman_esbres_1.log
clean_all_logs.sh    esbdata2.sh          esbinf2.sh_old       oradiag_oracle       pfile.esbpoc.ora     rman_esbres_1.rcv
clean_audit_file.sh  esbinf.ora           esbinf21.ora         orapwesbdata22       rman_esbres.log      rman_esbres_1.sh
[oracle@dr-esb-db01(/home/oracle)]$mv esbinf2.sh_new  esbinf2.sh
[oracle@dr-esb-db01(/home/oracle)]$vi esbinf2.sh
#!/bin/sh
# file: /home/oracle/bin/bk_script/bk_esbinf2.sh
# -----------------------------------------------------------------
# Set enviroment agrument
# -----------------------------------------------------------------

HOSTNAME=dr-esb-db02-pub
export HOSTNAME
ORACLE_UNQNAME=esbinf2
export ORACLE_UNQNAME
ORACLE_SID="$ORACLE_UNQNAME"1
export ORACLE_SID
POLICY=Backup-Esbinf2
export POLICY
ORACLE_HOME=/u01/app/oracle/db11
export ORACLE_HOME
TARGET_CONNECT_STR=srv_db_backup/Window#123#Tech@$ORACLE_SID
export TARGET_CONNECT_STR
RUN_AS_USER=oracle
export RUN_AS_USER
RMAN=$ORACLE_HOME/bin/rman
export RMAN
CUSER=`id | cut -d"(" -f2 | cut -d ")" -f1`
export CUSER


RMAN_LOG_FILE=/tmp/rman_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export RMAN_LOG_FILE
BK_LOG=/tmp/bk_db_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export BK_LOG

# -----------------------------------------------------------------
# Initialize the log file.
# -----------------------------------------------------------------

> $RMAN_LOG_FILE
chmod 666 $RMAN_LOG_FILE

# -----------------------------------------------------------------
# Log the start of this script.
# -----------------------------------------------------------------

#!/bin/sh
# file: /home/oracle/bin/bk_script/bk_esbinf2.sh
# -----------------------------------------------------------------
# Set enviroment agrument
# -----------------------------------------------------------------

HOSTNAME=dr-esb-db02-pub
export HOSTNAME
ORACLE_UNQNAME=esbinf2
export ORACLE_UNQNAME
ORACLE_SID="$ORACLE_UNQNAME"1
export ORACLE_SID
export HOSTNAME
ORACLE_UNQNAME=esbinf2
export ORACLE_UNQNAME
ORACLE_SID="$ORACLE_UNQNAME"1
export ORACLE_SID
POLICY=Backup-Esbinf2
export POLICY
ORACLE_HOME=/u01/app/oracle/db11
export ORACLE_HOME
TARGET_CONNECT_STR=srv_db_backup/Window#123#Tech@$ORACLE_SID
export TARGET_CONNECT_STR
RUN_AS_USER=oracle
export RUN_AS_USER
RMAN=$ORACLE_HOME/bin/rman
export RMAN
CUSER=`id | cut -d"(" -f2 | cut -d ")" -f1`
export CUSER


RMAN_LOG_FILE=/tmp/rman_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export RMAN_LOG_FILE
BK_LOG=/tmp/bk_db_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export BK_LOG

# -----------------------------------------------------------------
# Initialize the log file.
# -----------------------------------------------------------------

> $RMAN_LOG_FILE
chmod 666 $RMAN_LOG_FILE

# -----------------------------------------------------------------
# Log the start of this script.
# -----------------------------------------------------------------

echo Script $0 >> $RMAN_LOG_FILE

echo ==== started on `date` ==== >> $RMAN_LOG_FILE

echo >> $RMAN_LOG_FILE





# -----------------------------------------------------------------

# Setup Policy

# -----------------------------------------------------------------



if [ "$NB_ORA_FULL" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=0"

    SCHED_NAME="Full-Application-Backup"

        FILES_PER_SET=4

        TAG_TYPE=DATA_lv0

elif [ "$NB_ORA_INCR" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=1"

    SCHED_NAME="Different-Application-Backup"

        FILES_PER_SET=10

        TAG_TYPE=DATA_lv1

elif [ "$NB_ORA_CINC" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=1 CUMULATIVE"

elif [ "$BACKUP_TYPE" = "" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=0"

fi



# -----------------------------------------------------------------

# rman commands for database pub.

# -----------------------------------------------------------------



CMD="

ORACLE_HOME=/u01/app/oracle/db11

export ORACLE_HOME

$RMAN target $TARGET_CONNECT_STR nocatalog msglog $RMAN_LOG_FILE append <<EOF



# -----------------------------------------------------------------

# RMAN command section

# -----------------------------------------------------------------



RUN {

CONFIGURE CONTROLFILE AUTOBACKUP ON;



ALLOCATE CHANNEL ch01   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbinf21';

ALLOCATE CHANNEL ch02   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbinf21';

#!/bin/sh
# file: /home/oracle/bin/bk_script/bk_esbinf2.sh
# -----------------------------------------------------------------
# Set enviroment agrument
# -----------------------------------------------------------------

HOSTNAME=dr-esb-db02-pub
export HOSTNAME
ORACLE_UNQNAME=esbinf2
export ORACLE_UNQNAME
ORACLE_SID="$ORACLE_UNQNAME"1
export ORACLE_SID
POLICY=Backup-Esbinf2
export POLICY
ORACLE_HOME=/u01/app/oracle/db11
export ORACLE_HOME
TARGET_CONNECT_STR=srv_db_backup/Window#123#Tech@$ORACLE_SID
export TARGET_CONNECT_STR
RUN_AS_USER=oracle
export RUN_AS_USER
RMAN=$ORACLE_HOME/bin/rman
export RMAN
CUSER=`id | cut -d"(" -f2 | cut -d ")" -f1`
export CUSER


RMAN_LOG_FILE=/tmp/rman_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export RMAN_LOG_FILE
BK_LOG=/tmp/bk_db_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export BK_LOG

# -----------------------------------------------------------------
# Initialize the log file.
# -----------------------------------------------------------------

> $RMAN_LOG_FILE
chmod 666 $RMAN_LOG_FILE

# -----------------------------------------------------------------
# Log the start of this script.
# -----------------------------------------------------------------

echo Script $0 >> $RMAN_LOG_FILE

echo ==== started on `date` ==== >> $RMAN_LOG_FILE

echo >> $RMAN_LOG_FILE





# -----------------------------------------------------------------

# Setup Policy

# -----------------------------------------------------------------



if [ "$NB_ORA_FULL" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=0"

    SCHED_NAME="Full-Application-Backup"

        FILES_PER_SET=4

        TAG_TYPE=DATA_lv0

elif [ "$NB_ORA_INCR" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=1"

    SCHED_NAME="Different-Application-Backup"

        FILES_PER_SET=10

        TAG_TYPE=DATA_lv1

elif [ "$NB_ORA_CINC" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=1 CUMULATIVE"

elif [ "$BACKUP_TYPE" = "" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=0"

fi



# -----------------------------------------------------------------

# rman commands for database pub.

# -----------------------------------------------------------------



CMD="

ORACLE_HOME=/u01/app/oracle/db11

export ORACLE_HOME

$RMAN target $TARGET_CONNECT_STR nocatalog msglog $RMAN_LOG_FILE append <<EOF



# -----------------------------------------------------------------

# RMAN command section

# -----------------------------------------------------------------



RUN {

CONFIGURE CONTROLFILE AUTOBACKUP ON;



ALLOCATE CHANNEL ch01   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbinf21';

ALLOCATE CHANNEL ch02   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbinf21';

ALLOCATE CHANNEL ch03   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbinf21';

ALLOCATE CHANNEL ch04   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbinf21';

ALLOCATE CHANNEL ch05   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbinf22';

ALLOCATE CHANNEL ch06   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbinf22';

ALLOCATE CHANNEL ch07   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbinf22';

ALLOCATE CHANNEL ch08   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbinf22';



SEND 'NB_ORA_SCHED=$SCHED_NAME,NB_ORA_POLICY=$POLICY,NB_ORA_SERV=dr-backup-01.headquarter.techcombank.com.vn';



CROSSCHECK ARCHIVELOG ALL;

DELETE NOPROMPT EXPIRED ARCHIVELOG ALL;

CROSSCHECK BACKUP;

DELETE EXPIRED BACKUP;

BACKUP AS COMPRESSED BACKUPSET $BACKUP_TYPE FORMAT 'data_%d_%Y%M%D_%U' DATABASE FILESPERSET $FILES_PER_SET TAG $TAG_TYPE;

BACKUP AS COMPRESSED BACKUPSET NOT BACKED UP FORMAT 'arch_%d_%Y%M%D_%U' ARCHIVELOG ALL FILESPERSET 20 TAG ARCH;

BACKUP AS COMPRESSED BACKUPSET FORMAT 'ctl_%d_%Y%M%D_%U' CURRENT CONTROLFILE TAG CTRL;

DELETE NOPROMPT ARCHIVELOG UNTIL TIME 'SYSDATE-3';



RELEASE CHANNEL ch01;

RELEASE CHANNEL ch02;

RELEASE CHANNEL ch03;

RELEASE CHANNEL ch04;

RELEASE CHANNEL ch05;

RELEASE CHANNEL ch06;

RELEASE CHANNEL ch07;

RELEASE CHANNEL ch08;



}

EOF

"



if [ "$CUSER" = "root" ]

then

    su - $RUN_AS_USER -c "$CMD" >> $RMAN_LOG_FILE

    RSTAT=$?

else

    sh -c "$CMD" >> $RMAN_LOG_FILE

    RSTAT=$?

fi


:q!
[oracle@dr-esb-db01(/home/oracle)]$ls
DBscript             crontab.job.txt      esbinf1.sh           esblog21.pfile       pfile.esbinf1.ora    rman_esbres.log_old  test.sh
LMS                  dbscript             esbinf1.sh_fix       esbtest.sh           pfile.esblog.ora     rman_esbres.rcv      tests.l
OracleLMS_Aug        esb_restore.ora      esbinf1.sh_old       fresh_truss.ok       pfile.esblog1.ora    rman_esbres.sh       time.log
bin                  esbdata2.ora         esbinf2.sh           nohup.out            pfile.esblog11.ora   rman_esbres_1.log
clean_all_logs.sh    esbdata2.sh          esbinf2.sh_old       oradiag_oracle       pfile.esbpoc.ora     rman_esbres_1.rcv
clean_audit_file.sh  esbinf.ora           esbinf21.ora         orapwesbdata22       rman_esbres.log      rman_esbres_1.sh
[oracle@dr-esb-db01(/home/oracle)]$mv esbinf2.sh esbinf2.sh_new
[oracle@dr-esb-db01(/home/oracle)]$mv esbinf2.sh_old esbinf2.sh    
[oracle@dr-esb-db01(/home/oracle)]$ls
DBscript             crontab.job.txt      esbinf1.sh           esblog21.pfile       pfile.esbinf1.ora    rman_esbres.log_old  test.sh
LMS                  dbscript             esbinf1.sh_fix       esbtest.sh           pfile.esblog.ora     rman_esbres.rcv      tests.l
OracleLMS_Aug        esb_restore.ora      esbinf1.sh_old       fresh_truss.ok       pfile.esblog1.ora    rman_esbres.sh       time.log
bin                  esbdata2.ora         esbinf2.sh           nohup.out            pfile.esblog11.ora   rman_esbres_1.log
clean_all_logs.sh    esbdata2.sh          esbinf2.sh_new       oradiag_oracle       pfile.esbpoc.ora     rman_esbres_1.rcv
clean_audit_file.sh  esbinf.ora           esbinf21.ora         orapwesbdata22       rman_esbres.log      rman_esbres_1.sh
[oracle@dr-esb-db01(/home/oracle)]$cd bin/bk_script 
[oracle@dr-esb-db01(/home/oracle/bin/bk_script)]$cd new
[oracle@dr-esb-db01(/home/oracle/bin/bk_script/new)]$ls
esbdata2.sh            esbinf1.sh             esbinf2.sh             switchlog_esbdata.sh   switchlog_esbinfra.sh
[oracle@dr-esb-db01(/home/oracle/bin/bk_script/new)]$cp esbdata2.sh esbdata2.sh_new
[oracle@dr-esb-db01(/home/oracle/bin/bk_script/new)]$mv esbdata2.sh_new ~/
[oracle@dr-esb-db01(/home/oracle/bin/bk_script/new)]$cd
[oracle@dr-esb-db01(/home/oracle)]$ls
DBscript             crontab.job.txt      esbinf.ora           esbinf21.ora         orapwesbdata22       rman_esbres.log      rman_esbres_1.sh
LMS                  dbscript             esbinf1.sh           esblog21.pfile       pfile.esbinf1.ora    rman_esbres.log_old  test.sh
OracleLMS_Aug        esb_restore.ora      esbinf1.sh_fix       esbtest.sh           pfile.esblog.ora     rman_esbres.rcv      tests.l
bin                  esbdata2.ora         esbinf1.sh_old       fresh_truss.ok       pfile.esblog1.ora    rman_esbres.sh       time.log
clean_all_logs.sh    esbdata2.sh          esbinf2.sh           nohup.out            pfile.esblog11.ora   rman_esbres_1.log
clean_audit_file.sh  esbdata2.sh_new      esbinf2.sh_new       oradiag_oracle       pfile.esbpoc.ora     rman_esbres_1.rcv
[oracle@dr-esb-db01(/home/oracle)]$vi esbinf1.sh
#!/bin/sh
# file: /home/oracle/bin/bk_script/bk_esbinf1.sh
# -----------------------------------------------------------------
# Set enviroment agrument
# -----------------------------------------------------------------

HOSTNAME=dr-esb-db02-pub
export HOSTNAME
ORACLE_UNQNAME=esbinf1
export ORACLE_UNQNAME
ORACLE_SID="$ORACLE_UNQNAME"1
export ORACLE_SID
ORACLE_SID_DC=esbinfra
export ORACLE_SID_DC
POLICY=Backup-Esbinf1
export POLICY
ORACLE_HOME=/u01/app/oracle/db11
export ORACLE_HOME
TARGET_CONNECT_STR=srv_db_backup/Window#123#Tech@$ORACLE_SID
export TARGET_CONNECT_STR
RUN_AS_USER=oracle
export RUN_AS_USER
RMAN=$ORACLE_HOME/bin/rman
export RMAN
CUSER=`id | cut -d"(" -f2 | cut -d ")" -f1`
export CUSER


RMAN_LOG_FILE=/tmp/rman_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export RMAN_LOG_FILE
BK_LOG=/tmp/bk_db_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export BK_LOG
SWITCHLOG=/home/oracle/bin/bk_script/switchlog_"$ORACLE_SID_DC".sh
export SWITCHLOG

# -----------------------------------------------------------------
# switch log DC.
# -----------------------------------------------------------------

if [ "$CUSER" = "root" ]
then
        echo > $SWITCHLOG
#!/bin/sh
# file: /home/oracle/bin/bk_script/bk_esbinf1.sh
# -----------------------------------------------------------------
# Set enviroment agrument
# -----------------------------------------------------------------

HOSTNAME=dr-esb-db02-pub
export HOSTNAME
ORACLE_UNQNAME=esbinf1
export ORACLE_UNQNAME
ORACLE_SID="$ORACLE_UNQNAME"1
export ORACLE_SID
ORACLE_SID_DC=esbinfra
export ORACLE_SID_DC
POLICY=Backup-Esbinf1
export POLICY
ORACLE_HOME=/u01/app/oracle/db11
export ORACLE_HOME
TARGET_CONNECT_STR=srv_db_backup/Window#123#Tech@$ORACLE_SID
export TARGET_CONNECT_STR
RUN_AS_USER=oracle
export RUN_AS_USER
RMAN=$ORACLE_HOME/bin/rman
export RMAN
CUSER=`id | cut -d"(" -f2 | cut -d ")" -f1`
export CUSER


RMAN_LOG_FILE=/tmp/rman_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export RMAN_LOG_FILE
BK_LOG=/tmp/bk_db_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export BK_LOG
SWITCHLOG=/home/oracle/bin/bk_script/switchlog_"$ORACLE_SID_DC".sh
export SWITCHLOG

# -----------------------------------------------------------------
# switch log DC.
# -----------------------------------------------------------------

if [ "$CUSER" = "root" ]
then
        echo > $SWITCHLOG
        echo "export ORACLE_HOME=/u01/app/oracle/db11" >> $SWITCHLOG

        echo "$ORACLE_HOME/bin/sqlplus -s srv_db_backup/Window#123#Tech@$ORACLE_SID_DC as sysdba <<EOF " >> $SWITCHLOG

        echo "alter system archive log current;" >> $SWITCHLOG

        echo "exit" >> $SWITCHLOG

        echo "EOF" >> $SWITCHLOG

        chmod 775 $SWITCHLOG

fi



# -----------------------------------------------------------------

# Initialize the log file.

# -----------------------------------------------------------------



> $RMAN_LOG_FILE

chmod 666 $RMAN_LOG_FILE



# -----------------------------------------------------------------

# Log the start of this script.

# -----------------------------------------------------------------



echo Script $0 >> $RMAN_LOG_FILE

echo ==== started on `date` ==== >> $RMAN_LOG_FILE

echo >> $RMAN_LOG_FILE





# -----------------------------------------------------------------

# Setup Policy

# -----------------------------------------------------------------



if [ "$NB_ORA_FULL" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=0"

    SCHED_NAME="Full-Application-Backup"

        FILES_PER_SET=4

        TAG_TYPE=DATA_lv0

elif [ "$NB_ORA_INCR" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=1"

    SCHED_NAME="Different-Application-Backup"

        FILES_PER_SET=10

        TAG_TYPE=DATA_lv1

elif [ "$NB_ORA_CINC" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=1 CUMULATIVE"

elif [ "$BACKUP_TYPE" = "" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=0"

fi



# -----------------------------------------------------------------

# rman commands for database pub.

# -----------------------------------------------------------------



CMD="

ORACLE_HOME=/u01/app/oracle/db11

export ORACLE_HOME

$RMAN target $TARGET_CONNECT_STR nocatalog msglog $RMAN_LOG_FILE append <<EOF



# -----------------------------------------------------------------

# RMAN command section

# -----------------------------------------------------------------



RUN {

CONFIGURE CONTROLFILE AUTOBACKUP ON;



ALLOCATE CHANNEL ch00   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db01-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf11';

ALLOCATE CHANNEL ch01   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db02-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf12';

ALLOCATE CHANNEL ch02   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db01-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf11';

ALLOCATE CHANNEL ch03   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db02-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf12';

ALLOCATE CHANNEL ch04   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db01-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf11';

ALLOCATE CHANNEL ch05   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db02-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf12';

ALLOCATE CHANNEL ch06   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db01-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf11';

ALLOCATE CHANNEL ch07   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=dr-esb-db02-pub)' CONNECT='srv_db_backup/Window#123#Tech@esbinf12';

SEND 'NB_ORA_SCHED=$SCHED_NAME,NB_ORA_POLICY=$POLICY,NB_ORA_SERV=dr-backup-01.headquarter.techcombank.com.vn';



BACKUP AS COMPRESSED BACKUPSET $BACKUP_TYPE FORMAT 'data_%d_%Y%M%D_%U' DATABASE FILESPERSET $FILES_PER_SET TAG $TAG_TYPE;

host \"$SWITCHLOG\";

BACKUP AS COMPRESSED BACKUPSET NOT BACKED UP FORMAT 'arch_%d_%Y%M%D_%U' ARCHIVELOG ALL FILESPERSET 20 TAG ARCH;

BACKUP AS COMPRESSED BACKUPSET FORMAT 'ctl_%d_%Y%M%D_%U' CURRENT CONTROLFILE TAG CTRL;

DELETE NOPROMPT ARCHIVELOG UNTIL TIME 'SYSDATE-3';



RELEASE CHANNEL ch01;

RELEASE CHANNEL ch02;

RELEASE CHANNEL ch03;

RELEASE CHANNEL ch04;

RELEASE CHANNEL ch05;


CROSSCHECK ARCHIVELOG ALL;
DELETE NOPROMPT EXPIRED ARCHIVELOG ALL;
CROSSCHECK BACKUP;
"esbinf1.sh" 166 lines, 5589 characters 
[oracle@dr-esb-db01(/home/oracle)]$
[oracle@dr-esb-db01(/home/oracle)]$
[oracle@dr-esb-db01(/home/oracle)]$ls
DBscript             crontab.job.txt      esbinf.ora           esbinf21.ora         orapwesbdata22       rman_esbres.log      rman_esbres_1.sh
LMS                  dbscript             esbinf1.sh           esblog21.pfile       pfile.esbinf1.ora    rman_esbres.log_old  test.sh
OracleLMS_Aug        esb_restore.ora      esbinf1.sh_fix       esbtest.sh           pfile.esblog.ora     rman_esbres.rcv      tests.l
bin                  esbdata2.ora         esbinf1.sh_old       fresh_truss.ok       pfile.esblog1.ora    rman_esbres.sh       time.log
clean_all_logs.sh    esbdata2.sh          esbinf2.sh           nohup.out            pfile.esblog11.ora   rman_esbres_1.log
clean_audit_file.sh  esbdata2.sh_new      esbinf2.sh_new       oradiag_oracle       pfile.esbpoc.ora     rman_esbres_1.rcv
[oracle@dr-esb-db01(/home/oracle)]$vi esbdata2.sh_new
#!/bin/sh
# file: /home/oracle/bin/bk_script/bk_esbdata2.sh
# -----------------------------------------------------------------
# Set enviroment agrument
# -----------------------------------------------------------------

HOSTNAME=dr-esb-db02-pub
export HOSTNAME
ORACLE_UNQNAME=esbdata2
export ORACLE_UNQNAME
ORACLE_SID="$ORACLE_UNQNAME"1
export ORACLE_SID
ORACLE_SID_DC=esbdata
export ORACLE_SID_DC
POLICY=Backup-Esbdata2
export POLICY
ORACLE_HOME=/u01/app/oracle/db11
export ORACLE_HOME
TARGET_CONNECT_STR=srv_db_backup/Window#123#Tech@$ORACLE_SID
export TARGET_CONNECT_STR
RUN_AS_USER=oracle
export RUN_AS_USER
RMAN=$ORACLE_HOME/bin/rman
export RMAN
CUSER=`id | cut -d"(" -f2 | cut -d ")" -f1`
export CUSER


RMAN_LOG_FILE=/tmp/rman_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export RMAN_LOG_FILE
BK_LOG=/tmp/bk_db_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export BK_LOG
SWITCHLOG=/home/oracle/bin/bk_script/switchlog_"$ORACLE_SID_DC".sh
export SWITCHLOG

# -----------------------------------------------------------------
# switch log DC.
# -----------------------------------------------------------------

if [ "$CUSER" = "root" ]
then
        su - $RUN_AS_USER -c "echo  " > $SWITCHLOG
#!/bin/sh
# file: /home/oracle/bin/bk_script/bk_esbdata2.sh
# -----------------------------------------------------------------
# Set enviroment agrument
# -----------------------------------------------------------------

HOSTNAME=dr-esb-db02-pub
export HOSTNAME
ORACLE_UNQNAME=esbdata2
export ORACLE_UNQNAME
ORACLE_SID="$ORACLE_UNQNAME"1
export ORACLE_SID
ORACLE_SID_DC=esbdata
export ORACLE_SID_DC
POLICY=Backup-Esbdata2
export POLICY
ORACLE_HOME=/u01/app/oracle/db11
export ORACLE_HOME
TARGET_CONNECT_STR=srv_db_backup/Window#123#Tech@$ORACLE_SID
export TARGET_CONNECT_STR
RUN_AS_USER=oracle
export RUN_AS_USER
RMAN=$ORACLE_HOME/bin/rman
export RMAN
CUSER=`id | cut -d"(" -f2 | cut -d ")" -f1`
export CUSER


RMAN_LOG_FILE=/tmp/rman_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export RMAN_LOG_FILE
BK_LOG=/tmp/bk_db_"$ORACLE_UNQNAME"_DAILY_$(date '+%Y%m%d_%H%M').log
export BK_LOG
SWITCHLOG=/home/oracle/bin/bk_script/switchlog_"$ORACLE_SID_DC".sh
export SWITCHLOG

# -----------------------------------------------------------------
# switch log DC.
# -----------------------------------------------------------------

if [ "$CUSER" = "root" ]
then
        su - $RUN_AS_USER -c "echo  " > $SWITCHLOG
        su - $RUN_AS_USER -c "echo export ORACLE_HOME=/u01/app/oracle/db11" >> $SWITCHLOG

        su - $RUN_AS_USER -c "echo $ORACLE_HOME/bin/sqlplus -s srv_db_backup/Window#123#Tech@$ORACLE_SID_DC as sysdba \<\<EOF " >> $SWITCHLOG

        su - $RUN_AS_USER -c "echo alter system archive log current\;" >> $SWITCHLOG

        su - $RUN_AS_USER -c "echo exit" >> $SWITCHLOG

        su - $RUN_AS_USER -c "echo EOF" >> $SWITCHLOG

        chmod 775 $SWITCHLOG

fi



# -----------------------------------------------------------------







then
        echo > $SWITCHLOG
        echo "export ORACLE_HOME=/u01/app/oracle/db11" >> $SWITCHLOG
        echo "$ORACLE_HOME/bin/sqlplus -s srv_db_backup/Window#123#Tech@$ORACLE_SID_DC as sysdba <<EOF " >> $SWITCHLOG
        echo "alter system archive log current;" >> $SWITCHLOG
        echo "exit" >> $SWITCHLOG
        echo "EOF" >> $SWITCHLOG
        chmod 775 $SWITCHLOG
fi

# -----------------------------------------------------------------
# Initialize the log file.

# -----------------------------------------------------------------



> $RMAN_LOG_FILE

chmod 666 $RMAN_LOG_FILE



# -----------------------------------------------------------------

# Log the start of this script.

# -----------------------------------------------------------------



echo Script $0 >> $RMAN_LOG_FILE

echo ==== started on `date` ==== >> $RMAN_LOG_FILE

echo >> $RMAN_LOG_FILE





# -----------------------------------------------------------------

# Setup Policy

# -----------------------------------------------------------------



if [ "$NB_ORA_FULL" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=0"

    SCHED_NAME="Full-Application-Backup"

        FILES_PER_SET=4

        TAG_TYPE=DATA_lv0

elif [ "$NB_ORA_INCR" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=1"

    SCHED_NAME="Different-Application-Backup"

        FILES_PER_SET=10

        TAG_TYPE=DATA_lv1

elif [ "$NB_ORA_CINC" = "1" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=1 CUMULATIVE"

elif [ "$BACKUP_TYPE" = "" ]

then

    BACKUP_TYPE="INCREMENTAL LEVEL=0"

fi



# -----------------------------------------------------------------

# rman commands for database pub.

# -----------------------------------------------------------------



CMD="

ORACLE_HOME=/u01/app/oracle/db11

export ORACLE_HOME

$RMAN target $TARGET_CONNECT_STR nocatalog msglog $RMAN_LOG_FILE append <<EOF



# -----------------------------------------------------------------

# RMAN command section

# -----------------------------------------------------------------



RUN {

CONFIGURE CONTROLFILE AUTOBACKUP ON;



ALLOCATE CHANNEL ch01   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbdata21';

ALLOCATE CHANNEL ch02   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbdata21';

ALLOCATE CHANNEL ch03   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbdata21';

ALLOCATE CHANNEL ch04   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbdata21';

ALLOCATE CHANNEL ch05   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbdata22';

ALLOCATE CHANNEL ch06   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbdata22';

ALLOCATE CHANNEL ch07   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbdata22';

ALLOCATE CHANNEL ch08   TYPE 'SBT_TAPE' PARMS='ENV=(NB_ORA_CLIENT=$HOSTNAME)' CONNECT='srv_db_backup/Window#123#Tech@esbdata22';



SEND 'NB_ORA_SCHED=$SCHED_NAME,NB_ORA_POLICY=$POLICY,NB_ORA_SERV=dr-backup-01.headquarter.techcombank.com.vn';



CROSSCHECK ARCHIVELOG ALL;

DELETE NOPROMPT EXPIRED ARCHIVELOG ALL;

CROSSCHECK BACKUP;

DELETE EXPIRED BACKUP;

BACKUP AS COMPRESSED BACKUPSET $BACKUP_TYPE FORMAT 'data_%d_%Y%M%D_%U' DATABASE FILESPERSET $FILES_PER_SET TAG $TAG_TYPE;

host \"$SWITCHLOG\";
"esbdata2.sh_new" 167 lines, 5552 characters 
[oracle@dr-esb-db01(/home/oracle)]$11
Shell will time out in 60 seconds.
1ksh: Timed out waiting for input.
