alter session force parallel dml parallel 4;
alter session force parallel query parallel 4;

================================
CREATE TABLE T24LIVE.F_OS_XML_CACHE
(
  RECID      VARCHAR2(255 BYTE),
  XMLRECORD  SYS.XMLTYPE
)
XMLTYPE XMLRECORD STORE AS SECUREFILE  (
  TABLESPACE  DATAT24LIVE
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  PCTVERSION  10
  NOCACHE
  NOLOGGING)
NOCOMPRESS 
TABLESPACE DATAT24LIVE
RESULT_CACHE (MODE DEFAULT)
PCTUSED    0
PCTFREE    20
INITRANS   120
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
PARTITION BY HASH (RECID)
  PARTITIONS 256
NOCACHE
NOPARALLEL
MONITORING;


CREATE UNIQUE INDEX T24LIVE.F_OS_XML_CACHE_INI_PK ON T24LIVE.F_OS_XML_CACHE_INI
(RECID)
  TABLESPACE INDEXT24LIVE
  PCTFREE    10
  INITRANS   2
  MAXTRANS   255
  STORAGE    (
              BUFFER_POOL      DEFAULT
              FLASH_CACHE      DEFAULT
              CELL_FLASH_CACHE DEFAULT
             )
LOGGING
LOCAL NOPARALLEL;


ALTER TABLE T24LIVE.F_OS_XML_CACHE_INI ADD (
  CONSTRAINT F_OS_XML_CACHE_INI_PK
  PRIMARY KEY
  (RECID)
  USING INDEX LOCAL
  ENABLE VALIDATE);

  
BEGIN
DBMS_REDEFINITION.CAN_REDEF_TABLE('T24LIVE','F_OS_XML_CACHE',DBMS_REDEFINITION.CONS_USE_PK);
END;
/

BEGIN
DBMS_REDEFINITION.START_REDEF_TABLE(
   uname       => 'T24LIVE',
   orig_table  => 'F_OS_XML_CACHE',
   int_table   => 'F_OS_XML_CACHE_INI',
   col_mapping => 'recid recid, xmlrecord xmlrecord',
   options_flag => DBMS_REDEFINITION.CONS_USE_PK);
END;
/
  
--------------------------------
CREATE TABLE T24LIVE.F_OS_XML_CACHE
(
  RECID      VARCHAR2(255 BYTE),
  XMLRECORD  SYS.XMLTYPE
)
XMLTYPE XMLRECORD STORE AS CLOB (
  TABLESPACE  DATAT24LIVE
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  PCTVERSION  10
  NOCACHE
  NOLOGGING)
NOCOMPRESS 
TABLESPACE DATAT24LIVE
RESULT_CACHE (MODE DEFAULT)
PCTUSED    0
PCTFREE    20
INITRANS   120
MAXTRANS   255
STORAGE    (
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
PARTITION BY HASH (RECID)
  PARTITIONS 256
  STORE IN (DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE,DATAT24LIVE)
NOCACHE
NOPARALLEL
MONITORING;

---------------------------F_EB_USER_CONTEXT---------------------------------------------
select * from dba_lobs where table_name='F_EB_USER_CONTEXT'

select segment_name,bytes/1024/1024 from dba_segments 
where segment_name in ('F_EB_USER_CONTEXT','LOB_F_EB_USER_CONTEXT','PK_F_EB_USER_CONTEXT','SYS_IL0047683867C00002$$')
order by 1


F_EB_USER_CONTEXT    268
LOB_F_EB_USER_CONTEXT    8
PK_F_EB_USER_CONTEXT    15
SYS_IL0047683867C00002$$    0.1875


F_EB_USER_CONTEXT    340
LOB_F_EB_USER_CONTEXT    8
PK_F_EB_USER_CONTEXT    11.625
SYS_IL0047683867C00002$$    0.1875

alter table T24LIVE.F_EB_USER_CONTEXT initrans 100;

alter table T24LIVE.F_EB_USER_CONTEXT move tablespace DATAT24LIVE;
Elapsed: 00:00:18.82

alter index T24LIVE.PK_F_EB_USER_CONTEXT rebuild tablespace INDEXT24LIVE online parallel 4;
Elapsed: 00:00:04.79
------------------------------------------------------------------------------------------


select segment_name, bytes/1024/1024 as MB from dba_segments where segment_name in ('FBNK_LD_L000','SYS_LOB0000080318C00003$$','PK_FBNK_LD_L000','IX_FBNK_LD_L000_C107','IX_FBNK_LD_L000_C167_2','IX_FBNK_LD_L000_C167_61','IX_FBNK_LD_L000_C2','IX_FBNK_LD_L000_C250','IX_FBNK_LD_L000_C90','NIX_FBNK_LD_L000_C1','NIX_FBNK_LD_L000_C11','NIX_FBNK_LD_L000_C13','NIX_FBNK_LD_L000_C7')

size in MB before change
FBNK_LD_L000	168
SYS_LOB0000080318C00003$$	5240
PK_FBNK_LD_L000	24.6875


FBNK_LD_L000	168
IX_FBNK_LD_L000_C107	6
IX_FBNK_LD_L000_C167_2	14.375
IX_FBNK_LD_L000_C167_61	9
IX_FBNK_LD_L000_C2	7.3125
IX_FBNK_LD_L000_C250	10.6875
IX_FBNK_LD_L000_C90	6.75
NIX_FBNK_LD_L000_C1	7.25
NIX_FBNK_LD_L000_C11	8.3125
NIX_FBNK_LD_L000_C13	6.1875
NIX_FBNK_LD_L000_C7	17.125
PK_FBNK_LD_L000	24.6875
SYS_LOB0000080318C00003$$	5240

ALTER TABLE T24LIVE.FBNK_LD_L000 MOVE TABLESPACE DATAT24LIVE;
Elapsed: 00:04:22.57
ALTER INDEX T24LIVE.PK_FBNK_LD_L000 REBUILD TABLESPACE INDEXT24LIVE ONLINE;
Elapsed: 00:00:00.80

ALTER INDEX T24LIVE.PK_FBNK_LD_L000 REBUILD TABLESPACE INDEXT24LIVE ONLINE;
alter index t24live.IX_FBNK_LD_L000_C107     rebuild tablespace indext24live ;
alter index t24live.IX_FBNK_LD_L000_C167_2   rebuild tablespace indext24live ;
alter index t24live.IX_FBNK_LD_L000_C167_61  rebuild tablespace indext24live ;
alter index t24live.IX_FBNK_LD_L000_C2       rebuild tablespace indext24live ;
alter index t24live.IX_FBNK_LD_L000_C250     rebuild tablespace indext24live ;
alter index t24live.IX_FBNK_LD_L000_C90      rebuild tablespace indext24live ;
alter index t24live.NIX_FBNK_LD_L000_C1      rebuild tablespace indext24live ;
alter index t24live.NIX_FBNK_LD_L000_C11     rebuild tablespace indext24live ;
alter index t24live.NIX_FBNK_LD_L000_C13     rebuild tablespace indext24live ;
alter index t24live.NIX_FBNK_LD_L000_C7      rebuild tablespace indext24live ;
Elapsed: 00:00:48.29


FBNK_LD_L000	89
SYS_LOB0000080318C00003$$	1153
PK_FBNK_LD_L000	4


FBNK_LD_L000	89
IX_FBNK_LD_L000_C107	2
IX_FBNK_LD_L000_C167_2	4
IX_FBNK_LD_L000_C167_61	3
IX_FBNK_LD_L000_C2	3
IX_FBNK_LD_L000_C250	3
IX_FBNK_LD_L000_C90	3
NIX_FBNK_LD_L000_C1	3
NIX_FBNK_LD_L000_C11	3
NIX_FBNK_LD_L000_C13	2
NIX_FBNK_LD_L000_C7	3
PK_FBNK_LD_L000	4
SYS_LOB0000080318C00003$$	1153

BEGIN
  SYS.DBMS_STATS.GATHER_TABLE_STATS (
      OwnName        => 'T24LIVE'
     ,TabName        => 'FBNK_LD_L000'
    ,Estimate_Percent  => 10
    ,Method_Opt        => 'FOR ALL COLUMNS SIZE 1'
    ,Degree            => 4
    ,Cascade           => FALSE
    ,No_Invalidate     => FALSE);
END;
/

Elapsed: 00:00:59.32

========================================================================================================================================================================================================
select segment_name, bytes/1024/1024 as MB from dba_segments where segment_name in ('FBNK_IC_C010','SYS_LOB0008887008C00003$$','PK_FBNK_IC_C010')
FBNK_IC_C010	4794
PK_FBNK_IC_C010	73
SYS_LOB0008887008C00003$$	16156

ALTER TABLE T24LIVE.FBNK_IC_C010 MOVE TABLESPACE DATAT24LIVE parallel 8;
Elapsed: 00:41:06.90
ALTER INDEX T24LIVE.PK_FBNK_IC_C010 REBUILD TABLESPACE INDEXT24LIVE ONLINE;
Elapsed: 00:00:15.25

FBNK_IC_C010	2063
PK_FBNK_IC_C010	53
SYS_LOB0008887008C00003$$	8397

CREATE TABLE T24LIVE.FBNK_IC_C010_INI
(
  RECID      VARCHAR2(255 BYTE)                 NOT NULL,
  XMLRECORD  SYS.XMLTYPE
)
XMLTYPE XMLRECORD STORE AS CLOB (
  TABLESPACE  DATAT24LIVE
  ENABLE      STORAGE IN ROW
  CHUNK       8192
  RETENTION
  CACHE
  LOGGING
  INDEX       LOBI_FBNK_IC_C010_INI
      STORAGE    (
                  INITIAL          64K
                  NEXT             1M
                  MINEXTENTS       1
                  MAXEXTENTS       UNLIMITED
                  PCTINCREASE      0
                  BUFFER_POOL      DEFAULT
                  FLASH_CACHE      DEFAULT
                  CELL_FLASH_CACHE DEFAULT
                 ))
TABLESPACE DATAT24LIVE
RESULT_CACHE (MODE DEFAULT)
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MAXSIZE          UNLIMITED
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;

BEGIN
DBMS_REDEFINITION.CAN_REDEF_TABLE('T24LIVE','FBNK_IC_C010',DBMS_REDEFINITION.CONS_USE_PK);
END;
/

alter session force parallel dml parallel 4;
alter session force parallel query parallel 4;


BEGIN
DBMS_REDEFINITION.START_REDEF_TABLE(
   uname        => 'T24LIVE',
   orig_table   => 'FBNK_IC_C010',
   int_table    => 'FBNK_IC_C010_INI',
   col_mapping  => NULL,
   options_flag => DBMS_REDEFINITION.cons_use_pk);
END;
/

DECLARE
num_errors PLS_INTEGER;
BEGIN
DBMS_REDEFINITION.COPY_TABLE_DEPENDENTS(
   'T24LIVE','FBNK_IC_C010','FBNK_IC_C010_INI',DBMS_REDEFINITION.CONS_ORIG_PARAMS,
    TRUE, TRUE, TRUE, FALSE, num_errors, TRUE);
END;
/

CREATE UNIQUE INDEX T24LIVE.PK_FBNK_IC_C010 ON T24LIVE.FBNK_IC_C010
(RECID)
LOGGING
TABLESPACE INDEXT24LIVE
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MAXSIZE          UNLIMITED
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
            FLASH_CACHE      DEFAULT
            CELL_FLASH_CACHE DEFAULT
           )
NOPARALLEL;

ALTER TABLE T24LIVE.FBNK_IC_C010_INI ADD (
  CONSTRAINT PK_FBNK_IC_C010_INI
  PRIMARY KEY
  (RECID)
  USING INDEX T24LIVE.TMP$$_PK_FBNK_IC_C0100
  ENABLE VALIDATE);

select object_name, base_table_name, ddl_txt from       DBA_REDEFINITION_ERRORS;



BEGIN 
DBMS_REDEFINITION.SYNC_INTERIM_TABLE('T24LIVE','FBNK_IC_C010','FBNK_IC_C010_INI');
END;
/

BEGIN
DBMS_REDEFINITION.FINISH_REDEF_TABLE('T24LIVE','FBNK_IC_C010','FBNK_IC_C010_INI');
END;
/